# 第七次作业指导书

## 第一部分：训练目标

本次作业的基本目标是模拟**多线程实时电梯系统**，在前两次作业的基础上，掌握线程之间的交互，强化线程之间的协同设计层次架构。

------

## 第二部分：题目概况 


我们要模拟的电梯系统是一个类似北京航空航天大学新主楼的电梯系统，楼座内有**多部电梯**，电梯可以在楼座内1-11层之间运行。系统从标准输入中读入乘客请求信息(起点层，终点楼层)，**请求调度器**会根据此时电梯运行情况(电梯所在楼层，运行方向等)将乘客请求合理**分配给某部电梯**，然后被分配请求的电梯会经过**上下行，开关门，乘客进入/离开电梯**等动作将乘客从起点层运送到终点层。请求的输入通过**我们提供的**输入接口来**定时投放**请求，你需要调用我们提供的接口，接口具体细节参考**第三部分和相关文档**。

可以采用**任何调度策略**，即任意时刻，系统选择上下行动，是否在某层开关门，乘客分配给哪部电梯都可以自定义，只要保证在**电梯系统运行时间不超过题目要求时间上限**的前提下将所有的乘客送至目的地即可。

------

## 第三部分：输入/输出接口

### 一、输入输出接口说明

- $1、$本单元作业**请使用官方提供的输入输出接口进行输入输出（见本次作业公开仓库）**。
- $2、$输入接口提供了若干方法，通过调用方法可以直接获取所需数据对象。输入接口在**尝试**读取标准输入的内容时，对于正确的输入将成功解析，错误的则输出错误信息，但不会影响程序的正常运行。
- $3、$输出子程序接受一个字符串，并附上时间戳后再输出。
- $4、$**详细的接口定义和使用方法见官方接口说明文档。**
- $5、$程序的输入输出为**实时交互**，评测机可以做到在某个时间点投放一定量的输入。
- $6、$**不需要考虑由于调用输入输出接口导致的时间上的差异**，可以认为**准时**投放请求和输出相关内容。
- $7、$**不需要对输入输出接口进行修改**。

------

## 第四部分：电梯运行

### 一、功能描述


完成乘客请求，即对于每个乘客请求(起点层，终点层)，需要调度电梯将其完成，并将必要的运行信息通过输出接口进行输出。具体而言，你需要控制电梯**上下行，开关门的动作**以及**控制乘客进出电梯**来将乘客从起点层运送到终点层。我们的电梯系统**有多部电梯**，你需要合理的调度这些电梯来达到更好的性能。


### 二、输入输出格式

#### 1.输入格式

- 每一行是一个乘客的到达信息。格式为：`[时间戳]乘客ID-FROM-起点层-TO-终点层`

#### 2.输出格式

- 通过调用输出接口的每一次输出将自动附加时间戳于头部，具体请参考**输出接口文档**，请不要试图伪造时间戳，否则会在实际评测时产生不一样的结果导致程序运行错误。
- 电梯到达某一位置：`[时间戳]ARRIVE-所在层-电梯ID[-(A|B)]`
- 电梯开始开门：`[时间戳]OPEN-所在层-电梯ID[-(A|B)]`
- 电梯完成关门：`[时间戳]CLOSE-所在层-电梯ID[-(A|B)]`
- 乘客进入电梯：`[时间戳]IN-乘客ID-所在层-电梯ID[-(A|B)]`
- 乘客离开电梯：`[时间戳]OUT-乘客ID-所在层-电梯ID[-(A|B)]`

注：[-(A|B)]针对本次作业新增的双轿厢电梯，'[]'表示可选，'(A|B)'表示'A'或者'B'

### 三、正确性说明

#### 电梯运行基本约束

* 电梯系统**默认初始在1层有6部电梯**，电梯默认性能参数如下：
	
	>* 可到达楼层：1-11层
	>* 初始位置：1层
	>* 数量：6部
	>* 编号：6部电梯，ID分别为1-6
	>* 移动一层花费的时间：0.4s
	>* 开门花费的时间：0.2s
	>* 关门花费的时间：0.2s
	>* 限乘人数：6人
	
* 电梯在两层楼之间移动应满足移动时间要求，且电梯只能在大楼的楼层范围内移动，电梯移动时必须关门。

* 电梯默认初始时为关门状态，电梯只有开门才可以关门，只有关门才可以开门，**且程序结束时所有电梯必须处于关门状态**。

* 乘客默认不在电梯里，只有进入电梯才可以出电梯，只有不在电梯里才可以进电梯，且乘客只能进入同层的电梯。

* 乘客**能且只能**在电梯开门和关门的窗口期内进出电梯，但乘客进出电梯**不需要时间**(~~纸片人没有厚度~~)。

* 运行时的任意时刻需满足轿厢容量限制，即电梯内**乘客数量不得超过轿厢容量**。

* 输出的时间戳应该满足**不减限制**，**系统结束时不可以有乘客请求未完成或乘客困在电梯里的情况出现**。

* 对电梯的调度不作限制，但需满足一定性能要求！

### 四、实现提示

- $1、$电梯的"运行策略"实际上可以抽象为从一组待选任务当中选取一个来执行。可以先编写一个**候乘表类**来显示当前电梯系统中各层等待电梯服务的乘客。再编写一个**策略类**，接受这个候乘表类，分析并返回一个目标动作（开关门、上下行等）。因此，分析的过程被隐藏在了策略类内部。

- $2、$将策略类实例对象作为电梯的一个属性，通过更换策略类，就可以灵活地切换执行策略。或应用工厂模式组装不同电梯。

- $3、$电梯的运行流程可以抽象为：到达一层→开门→乘客进出→关门→寻找下一目标层→移动，可以使用状态模式建模（后续可能添加reset等动作）。

  ![第一次指导书实现提示.drawio.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e9f962be-cb94-48f7-8a7c-90f49feecd57/2ef3ac0f-517c-4f08-b514-407d0b35c3b4/%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8C%87%E5%AF%BC%E4%B9%A6%E5%AE%9E%E7%8E%B0%E6%8F%90%E7%A4%BA.drawio.png)

  在**不违反课程规则**的前提下，我们对电梯的**捎带策略不做限制**。鼓励同学们多多阅读并自行探索相关算法，对电梯的捎带策略有自己的设计与思考。为保证同学们实现的都为作业要求的**可捎带电梯**，我们对电梯的性能做一定的约束，采用**ALS调度策略**为性能**基准**（关于调度策略，欢迎大家积极上网找资料探索）。

对于每一个电梯，都采用 ALS 策略，即新增**主请求**和**被捎带请求**两个概念

- $1、$主请求选择规则：

  - $(1)、$如果电梯中没有乘客，将请求队列中到达时间最早的请求作为主请求
  - $(2)、$如果电梯中有乘客，将其中到达时间最早的乘客请求作为主请求

- $2、$被捎带请求选择规则：

  - $(1)、$电梯的主请求存在
  - $(2)、$该请求投喂的时刻**小于等于**电梯到达该请求出发楼层关门的截止时间
  - $(3)、$电梯的运行方向和该请求的目标方向一致

- $3、$在电梯的调度上，**可以**采用一种较为均衡的调度方式，例如7层有5个乘客，3部电梯，那么第1个乘客分配给第1部电梯，第2个乘客分配给第2部电梯，第3个乘客分配给第3部电梯，第4个乘客分配给第1部电梯，第5个乘客分配给第2部电梯。

  请同学们合理设计自己的调度策略，保证自己的电梯**性能符合基本要求**，即程序运行时间$T\leq T_{max}$,$T_{max}$的定义见**公测数据限制**

### 五、数据限制

#### 一、数据基本限制

- 可输入电梯系统的指令数：**1~100条**（指令数为0或超过100均为不合法输入）。
- 乘客$ID$保证不重复，存在于电梯系统内的电梯$ID$保证不重复，所有$ID$均为int范围内正整数。
- 乘客请求中保证起点层和终点层不同。
- 输入数据的时间戳精确到**小数点后一位**。

#### 二、公测数据限制

- 标程运行时间$T_{std}$：课程组标程运行测试点所使用的时间。
- 公测中$T_{max}$与标程运行时间$T_{std}$的计算公式如下。

  $$ T_{max} = \max\left(T_{std}+10, 1.15\times T_{std}\right) $$

- 包括强测在内的数据都会保证正常程序的电梯系统时间不会超过 $T_{max}$，也会**避免使用对边界情况较为敏感的数据**。
- **对于中测和强测数据，$T_{max}$ 将会严格限制为通过上述公式计算得到的值。**<del>所以，请不要试图用超长的 sleep 来回避线程安全停止的问题。</del>

#### 三、互测数据限制

- 系统时间上限 $T_{max}$：对于互测数据，$T_{max}$ 为220s。
- 第一条指令的投喂时间在1s或1s以后。
- 最后一条指令的输入时间不晚于50s。
- 指令条数不超过70。
- 随测试点提交的输出合法。

---

## 第五部分：电梯重置

### 一、功能描述

接收到重置指令的电梯需要**尽快停靠后**完成重置动作，**再投入电梯系统运行**。为安全起见，电梯重置时内部**不可以**有乘客，且重置动作**需要时间**$T_{reset}=1.2s$。

有**两种**重置请求：

1. 第一类重置请求仅修改电梯参数，重置参数请求包含需要重置的电梯ID和电梯相关参数（`满载人数`、`移动时间`）。程序需要在重置完成后让电梯以新的参数运行，重置完成后，电梯处于原楼层(**同上一次作业**)。
2. 第二类重置请求将电梯修改为双轿厢电梯，重置参数包含需要重置的电梯ID，换乘楼层，两个轿厢的相关参数（移动一层的时间和满载人数）相同。当重置完成后，**轿厢 A 默认初始在换乘楼层的下面一层，轿厢B默认初始换乘楼层的上面一层**。（<font color=red>本次新增</font>）

**两种重置操作的区别仅在于结果**（重置为操作完成后的影响），完成过程及与RECEIVE的约束关系与上次作业完全相同。

### 二、双轿厢电梯运行

双轿厢电梯是指在同一电梯井道内同时拥有两个独立的电梯轿厢，而电梯系统默认的普通电梯是指在一个电梯井道内只有一个轿厢。为了保证两个轿厢不相互碰撞，将楼层分为上区、下区、换乘楼层，其中上区为换乘楼层以上的所有楼层，下区为换乘楼层以下的楼层，均不包含换乘楼层。在整个运行过程中，要求轿厢 A 只能在下区和换乘楼层运行，轿厢 B 只能在上区和换乘楼层运行，**同一井道内的两轿厢不能同时位于换乘楼层**。请思考双轿厢电梯的优势（包括双轿厢电梯耗电量优势，具体定义见性能分说明部分），合理设计调度方案。

### 三、输入输出格式

#### 1、输入格式

- 第一类重置：` [时间戳]RESET-Elevator-电梯ID-满载人数-移动一层的时间(单位s) `
- 第二类重置：`[时间戳]RESET-DCElevator-电梯ID-换乘楼层-每个轿厢的满载人数-每个轿厢移动一层的时间(单位s)`

#### 2、输出格式

- 电梯接收到第一类重置请求：`[时间戳]RESET_ACCEPT-电梯ID-满载人数-移动一层的时间(单位s) `（该消息由官方包自动输出，同学无需输出）
- 电梯接收到第二类重置请求：`[时间戳]RESET_ACCEPT-电梯ID-换乘楼层-每个轿厢的满载人数-每个轿厢移动一层的时间(单位s)`（该消息由官方包自动输出，同学无需输出）
- 电梯开始重置：`[时间戳]RESET_BEGIN-电梯ID`
- 电梯重置完成：`[时间戳]RESET_END-电梯ID`

### 四、正确性说明

- 未接收到重置指令的电梯**不得进行重置**，**不得修改电梯运行参数**，以免造成评测错误。

- 接收到重置指令的电梯必须在**两次移动楼层操作内**将所有乘客放出，并输出`RESET_BEGIN-电梯ID`开始重置动作。 

  *  “在两次移动楼层操作内”指的是在官方包自动输出`RESET_ACCEPT `开始，该部电梯在输出`RESET_BEGIN`之前至多输出两条`ARRIVE`。 
  *  请同学们在接收到重置指令后**尽快**完成重置动作,`RESET_ACCEPT`和`RESET_END`之间的时间记为响应时间$T_{complete},T_{complete}$**不得超过5s**。

- 电梯输出`RESET_BEGIN-电梯ID`时必须保证电梯轿厢内**没有人**，且**门是关闭的**。

- 输出`RESET_BEGIN-电梯ID` 和输出`RESET_END-电梯ID`之间电梯不得参与电梯调度，即不能开关门、进出乘客、上下楼层、输出RECEIVE（见`RECEIVE`约束）等，处于**静默状态**。

- 同一井道内两轿厢同时位于换乘楼层是指某一轿厢处于换乘楼层且未到达另一楼层时，另一轿厢到达换乘楼层，例如：

  ```java
    ....  ← 1号电梯被重置为双轿厢电梯，换乘楼层在7层
    [   4.6280]ARRIVE-7-1-A
    [   4.7380]ARRIVE-7-1-B ← 两轿厢同时位于换乘楼层！
    [   4.8490]ARRIVE-6-1-A      
  ```

* **双轿厢电梯有关的RECEIVE约束有特殊说明**，详见`第六部分RECEIVE约束`。

### 五、实现提示

* 仔细思考： 中途下电梯的乘客和从起始位置出发的乘客对程序而言有区别吗？ 
* 重置请求是否可以认为是电梯运行逻辑中的一个动作（类似开关门、上下行）？
* 对于双轿厢电梯，是否总可以通过两个轿厢的协作完成**任意**请求？

### 六、数据限制

#### 一、数据基本限制

- 输入保证在程序逻辑正确的前提下，进行重置操作的电梯已存在于当前电梯系统中。
- **不保证**重置后电梯性能更优或更劣。
- 重置后的电梯满足如下限制：
  * 移动一层的时间$\in\{0.2,0.3,0.4,0.5,0.6\}$
  * 满载人数$\in\{3,4,5,6,7,8\}$
- **在电梯合理运行的情况下，保证电梯在下次收到RESET请求前可以完成上个RESET请求。**
- **保证双轿厢电梯不会接收到第一类重置请求和第二类重置请求**。
- **存在所有电梯均被重置为双轿厢电梯的可能**。
- 换乘楼层在3层和9层之间。

#### 二、公测数据限制

* 重置指令数不超过**20**条。

#### 三、互测数据限制

* 一部电梯最多重置一次。
* 第一条指令的投喂时间在1s或1s以后。
* 最后一条指令的输入时间不晚于50s。
* 随测试点提交的输出合法。

---

## 第六部分：RECEIVE约束

### 一、功能描述

为避免出现多部电梯接送同一乘客造成资源浪费的情况，引入RECEIVE约束。同时我们希望同学们将`RECEIVE`作为调度器的**附加输出**来说明自己的分配方案，边界情况见**正确性说明**。

### 二、输入输出格式

#### 输出格式

- 电梯接收分配：`[时间戳]RECEIVE-乘客ID-电梯ID[-(A|B)]`

### 三、正确性说明

同学们需要在**乘客进入电梯和电梯移动前**输出`RECEIVE`来说明乘客请求分配情况。

- 乘客只能在**电梯外**才可以有相关RECEIVE输出（**请同学们注意OUT、IN和RECEIVE的输出顺序**）

- **任何时刻任何一个乘客请求都至多会被分配给一部电梯**，乘客**只能**进入RECEIVE输出规定的电梯。

- 电梯内没有乘客且没有`RECEIVE`到某个乘客请求时的移动（输出ARRIVE）是**不合法**的移动。

  ```java
    示例1：
    [   0.0010]2-FROM-3-TO-11 ← 输入
    [   0.4080]ARRIVE-2-1 	← 1号电梯为空电梯且未RECEIVE到任何乘客，移动不合法！
    示例2：
    [   0.0010]2-FROM-3-TO-11 ← 输入
    [   0.0280]RECEIVE-2-2    ← 2号电梯RECEIVE到2号乘客
    [   0.4310]ARRIVE-2-2     ← 2号电梯移动合法！
    示例3：
    [   0.0010]2-FROM-3-TO-11 ← 输入
    [   0.0280]RECEIVE-2-2    ← 2号电梯RECEIVE到2号乘客
    [   0.0340]RECEIVE-2-3    ← 同一个乘客同时分配给了两个电梯，不合法！
  ```


* **特别地，双轿厢电梯可以不受RECEIVE约束地从换乘楼层移动一层以离开换乘楼层。**(<font color=red>本次新增</font>)

  ```java
    ....  					  ← 1号电梯被重置为双轿厢电梯，换乘楼层在7层
    [   1.4200]2-FROM-6-TO-11
    [   1.4230]RECEIVE-2-1-A    ←2号乘客分配给1号A轿厢电梯
    [   1.4370]OPEN-6-1-A
    [   1.4430]IN-2-6-1-A  	
    [   1.8560]CLOSE-6-1-A    
    [   2.2780]ARRIVE-8-1-B     ←1号B轿厢电梯离开换乘楼层不受RECEIVE约束
    [   2.6890]ARRIVE-7-1-A     
  ```

#### RECEIVE取消

`RECEIVE`被取消**当且仅当**以下两种情况发生：

* 电梯**开始重置**后，其**之前与此电梯**有关的`RECEIVE`全部取消。也即`[时间戳]RESET_BEGIN-电梯ID`输出后，之前仍有效的`RECEIVE-乘客ID-电梯ID`全部取消，相关乘客处于未分配状态，**电梯也视为未RECEIVE到任何乘客**。

* 乘客**中途**走出电梯后，相应的`RECEIVE`被取消。也即`[时间戳]OUT-乘客ID-所在层-电梯ID[-(A|B)]`输出后，**最近一个**`RECEIVE-乘客ID-电梯ID[-(A|B)]`被取消。

举例说明：

```java
  示例 1：
  [   4.6280]RECEIVE-2-1
  ....                      ← 2号乘客进入1号电梯，1号电梯开关门移动等动作输出
  [   6.8280]OUT-2-8-1
  [   6.9430]RECEIVE-2-2    ← 乘客走出1号电梯，上个RECEIVE被取消，合法输出！
  [   6.9670]IN-2-8-2       ← 有2号乘客和2号电梯的RECEIVE输出，2号乘客可以进入2号电梯
      
  示例 2：
  [   4.6280]RECEIVE-1-2
  [   4.6290]RECEIVE-2-2
  [   4.6296]RECEIVE-3-2      
  [   4.9670]OPEN-7-2
  [   5.3360]IN-1-7-2       ← 1号乘客进入2号电梯
  [   5.3370]IN-3-7-2       ← 3号乘客进入2号电梯      
  [   5.3360]CLOSE-7-2 
  ....                      ← 一些中间输出，1号和3号乘客已进入2号电梯，2号乘客此时还**未进入**2号电梯
  [   6.5630]RESET_ACCEPT-2-3-0.5
  [   6.6430]RECEIVE-3-3    ← 3号乘客此时在电梯内，不可以输出RECEIVE，不合法！   
  [   6.7640]OPEN-10-2
  [   6.7650]OUT-1-10-2
  [   6.7660]OUT-3-10-2
  [   7.1950]CLOSE-10-2 
  [   7.2160]RECEIVE-1-3    ← 由于1号乘客乘客走出了1号电梯，合法输出！ 
  [   7.2170]RESET_BEGIN-2    
  [   7.2180]RECEIVE-2-5    ← 有2号电梯的RESET_BEGIN，旧的RECEIVE被取消，合法输出！  
```

## 样例

| 输入                                                         | 输出                                                         | 说明                                             |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------ |
| [2.1]RESET-DCElevator-1-5-6-0.4<br/>[5.6]2-FROM-1-TO-10      | [   2.2030]RESET_ACCEPT-1-5-6-0.4<br/>[   2.2030]RESET_BEGIN-1<br/>[   3.4070]RESET_END-1<br/>[   5.7040]RECEIVE-2-1-A<br/>[   6.1160]ARRIVE-3-1-A<br/>[   6.5300]ARRIVE-2-1-A<br/>[   6.9380]ARRIVE-1-1-A<br/>[   6.9380]OPEN-1-1-A<br/>[   7.3520]IN-2-1-1-A<br/>[   7.3530]CLOSE-1-1-A<br/>[   7.7660]ARRIVE-2-1-A<br/>[   8.1780]ARRIVE-3-1-A<br/>[   8.5860]ARRIVE-4-1-A<br/>[   8.9960]ARRIVE-5-1-A<br/>[   8.9960]OPEN-5-1-A<br/>[   8.9970]OUT-2-5-1-A<br/>[   8.9970]RECEIVE-2-1-B<br/>[   9.4040]CLOSE-5-1-A<br/>[   9.8160]ARRIVE-4-1-A<br/>[  10.2300]ARRIVE-5-1-B<br/>[  10.2300]OPEN-5-1-B<br/>[  10.6390]IN-2-5-1-B<br/>[  10.6400]CLOSE-5-1-B<br/>[  11.0550]ARRIVE-6-1-B<br/>[  11.4650]ARRIVE-7-1-B<br/>[  11.8750]ARRIVE-8-1-B<br/>[  12.2890]ARRIVE-9-1-B<br/>[  12.7010]ARRIVE-10-1-B<br/>[  12.7020]OPEN-10-1-B<br/>[  12.7020]OUT-2-10-1-B<br/>[  13.1060]CLOSE-10-1-B | 下层电梯在换乘楼层时，上层电梯不可以到达换乘楼层 |
| [1.4]RESET-DCElevator-1-5-8-0.3<br/>[4.1]1-FROM-2-TO-9<br/>[5.3]RESET-DCElevator-2-6-8-0.3<br/>[8.9]RESET-DCElevator-6-8-6-0.4 | [   1.5050]RESET_ACCEPT-1-5-8-0.3<br/>[   1.5060]RESET_BEGIN-1<br/>[   2.7080]RESET_END-1<br/>[   4.1930]RECEIVE-1-4<br/>[   4.6030]ARRIVE-2-4<br/>[   4.6030]OPEN-2-4<br/>[   5.0100]IN-1-2-4<br/>[   5.0100]CLOSE-2-4<br/>[   5.4020]RESET_ACCEPT-2-6-8-0.3<br/>[   5.4020]RESET_BEGIN-2<br/>[   5.4180]ARRIVE-3-4<br/>[   5.8320]ARRIVE-4-4<br/>[   6.2430]ARRIVE-5-4<br/>[   6.6060]RESET_END-2<br/>[   6.6540]ARRIVE-6-4<br/>[   7.0650]ARRIVE-7-4<br/>[   7.4770]ARRIVE-8-4<br/>[   7.8880]ARRIVE-9-4<br/>[   7.8880]OPEN-9-4<br/>[   7.8900]OUT-1-9-4<br/>[   8.2980]CLOSE-9-4<br/>[   8.9970]RESET_ACCEPT-6-8-6-0.4<br/>[   8.9980]RESET_BEGIN-6<br/>[  10.2140]RESET_END-6 |                                                  |
| [1.9]2-FROM-10-TO-6<br/>[5.6]3-FROM-11-TO-6<br/>[8.5]RESET-Elevator-1-6-0.3<br/>[14.6]1-FROM-3-TO-5<br/>[15.5]RESET-DCElevator-1-5-6-0.4<br/>[16.6]9-FROM-1-TO-11 | [   2.0120]RECEIVE-2-4<br/>[   2.4160]ARRIVE-2-4<br/>[   2.8170]ARRIVE-3-4<br/>[   3.2280]ARRIVE-4-4<br/>[   3.6440]ARRIVE-5-4<br/>[   4.0580]ARRIVE-6-4<br/>[   4.4730]ARRIVE-7-4<br/>[   4.8810]ARRIVE-8-4<br/>[   5.2960]ARRIVE-9-4<br/>[   5.7040]ARRIVE-10-4<br/>[   5.7040]RECEIVE-3-1<br/>[   5.7050]OPEN-10-4<br/>[   6.1160]ARRIVE-2-1<br/>[   6.1160]IN-2-10-4<br/>[   6.1180]CLOSE-10-4<br/>[   6.5180]ARRIVE-3-1<br/>[   6.5290]ARRIVE-9-4<br/>[   6.9230]ARRIVE-4-1<br/>[   6.9390]ARRIVE-8-4<br/>[   7.3350]ARRIVE-5-1<br/>[   7.3520]ARRIVE-7-4<br/>[   7.7430]ARRIVE-6-1<br/>[   7.7590]ARRIVE-6-4<br/>[   7.7590]OPEN-6-4<br/>[   7.7600]OUT-2-6-4<br/>[   8.1540]ARRIVE-7-1<br/>[   8.1700]CLOSE-6-4<br/>[   8.5630]ARRIVE-8-1<br/>[   8.6120]RESET_ACCEPT-1-6-0.3<br/>[   8.9750]ARRIVE-9-1<br/>[   8.9750]RESET_BEGIN-1<br/>[   8.9760]RECEIVE-3-6<br/>[   9.3870]ARRIVE-2-6<br/>[   9.8020]ARRIVE-3-6<br/>[  10.1860]RESET_END-1<br/>[  10.2050]ARRIVE-4-6<br/>[  10.6140]ARRIVE-5-6<br/>[  11.0260]ARRIVE-6-6<br/>[  11.4370]ARRIVE-7-6<br/>[  11.8500]ARRIVE-8-6<br/>[  12.2660]ARRIVE-9-6<br/>[  12.6790]ARRIVE-10-6<br/>[  13.0910]ARRIVE-11-6<br/>[  13.0910]OPEN-11-6<br/>[  13.5020]IN-3-11-6<br/>[  13.5020]CLOSE-11-6<br/>[  13.9140]ARRIVE-10-6<br/>[  14.3240]ARRIVE-9-6<br/>[  14.7060]RECEIVE-1-3<br/>[  14.7370]ARRIVE-8-6<br/>[  15.1180]ARRIVE-2-3<br/>[  15.1490]ARRIVE-7-6<br/>[  15.5310]ARRIVE-3-3<br/>[  15.5320]OPEN-3-3<br/>[  15.5630]ARRIVE-6-6<br/>[  15.5630]OPEN-6-6<br/>[  15.5640]OUT-3-6-6<br/>[  15.6110]RESET_ACCEPT-1-5-6-0.4<br/>[  15.6120]RESET_BEGIN-1<br/>[  15.9410]IN-1-3-3<br/>[  15.9410]CLOSE-3-3<br/>[  15.9730]CLOSE-6-6<br/>[  16.3500]ARRIVE-4-3<br/>[  16.7120]RECEIVE-9-4<br/>[  16.7600]ARRIVE-5-3<br/>[  16.7600]OPEN-5-3<br/>[  16.7610]OUT-1-5-3<br/>[  16.8240]RESET_END-1<br/>[  17.1260]ARRIVE-5-4<br/>[  17.1740]CLOSE-5-3<br/>[  17.5420]ARRIVE-4-4<br/>[  17.9510]ARRIVE-3-4<br/>[  18.3650]ARRIVE-2-4<br/>[  18.7780]ARRIVE-1-4<br/>[  18.7780]OPEN-1-4<br/>[  19.1880]IN-9-1-4<br/>[  19.1880]CLOSE-1-4<br/>[  19.5970]ARRIVE-2-4<br/>[  20.0090]ARRIVE-3-4<br/>[  20.4130]ARRIVE-4-4<br/>[  20.8230]ARRIVE-5-4<br/>[  21.2250]ARRIVE-6-4<br/>[  21.6320]ARRIVE-7-4<br/>[  22.0380]ARRIVE-8-4<br/>[  22.4530]ARRIVE-9-4<br/>[  22.8650]ARRIVE-10-4<br/>[  23.2740]ARRIVE-11-4<br/>[  23.2740]OPEN-11-4<br/>[  23.2750]OUT-9-11-4<br/>[  23.6790]CLOSE-11-4 | 电梯可能在重置为双轿厢电梯前接到第一类重置请求   |

## 第八部分：性能分说明(有新增)

​	**本次作业功能分为85分，性能分为15分，二者之和为总分。**在强测时，性能分将由三部分组成：系统运行时间，等待时间与期望时间之差的最大值和系统耗电量。其中，系统运行时间即为$T_{run}=\max\{T_{real},T_{final}\}$。最大等待时间与期望时间之差计算方法如下。

​	对第$i$个请求，设其等待时间为$T_{i}=T_{到达目标楼层}-T_{发出请求}$，该请求的期望等待时间$ET_i$计算公式如下。
$$
ET_i=\frac{\sum_{f=F_{min}}^{F_{max}}|F_s-f|T_{move}}{F_{max}-F_{min}+1}+T_{open}+T_{close}+|F_d-F_s|T_{move}\\
F_{min}:电梯系统最低楼层\\
F_{max}:电梯系统最高楼层\\
F_s:请求的起始楼层\\
F_d:请求的目标楼层\\
T_{open}:开门时间\\
T_{close}:关门时间\\
T_{move}:电梯移动时间\\
$$
​	本次作业，上述公式中为定值的参数如下。
$$
F_{min}=1\\
F_{max}=11\\
T_{open}=0.2\\
T_{close}=0.2\\
T_{move}=0.4
$$
​	整个公式中，后三个数是电梯将该乘客送往目的楼层的所需时间，第一个项是在假设电梯在各楼层的概率分布为均匀分布时电梯到达起始楼层的期望。则等待时间与期望时间之差的最大值为
$$
MT=\max_i (T_{i}-ET_i)
$$
​	系统耗电量将使用以下方法计算。

​	根据输出信息中的`ARRIVE, OPEN, CLOSE`信息的数量进行计算。

- 每条`ARRIVE`信息表示电梯移动一层，耗电量$W_{ARRIVE}=0.4$
- 每条`OPEN(CLOSE)`信息表示电梯开门（关门）一次，耗电量$W_{OPEN}=W_{CLOSE}=0.1$
- <font color=red>双轿厢电梯耗电量为以上数据的$1\over4$</font>
- 系统的耗电量$W=W_{OPEN}N_{OPEN}+W_{CLOSE}N_{CLOSE}+W_{ARRIVE}N_{ARRIVE}$，其中$N_{OPEN},N_{CLOSE},N_{ARRIVE}$分别表示输出中$OPEN,CLOSE,ARRIVE$信息的总数。

​	设对于所有同学的数据，参数$x$的平均值为$x_{avg}$，最大值为$x_{max}$，最小值为$x_{min}$，则定义以下折算函数
$$
base_{min}=p\cdot x_{avg} + (1-p) \cdot x_{min}\\
base_{max}=p\cdot x_{avg} + (1-p) \cdot x_{max}\\
p=0.25\\
r(x)= 100 \% \cdot\begin{cases}1 & x \leq base_{min} \\1-10^{1-\frac{base_{max}-base_{min}}{x-base_{min}}} & base_{min} < x \leq base_{max} \\ 0 & x > base_{max}\end{cases}\\
$$
​	最终性能分$s$将由以下公式计算。
$$
s=15\times(0.3r(T_{run})+0.3r(MT)+0.4r(W))
$$
​	其中$T_{run},MT,W$为你的程序的运行时间，等待时间与期望时间之差的最大值和系统耗电量。

性能分公式可能比较复杂，但实际上公式表达出的意思就是希望你的程序**在保证正确性的前提下**能够尽量做到以下三点。

- 运行时间尽量短
- 尽量不让请求等待过长时间
- 尽量减少系统的无效运行

---


## 第九部分：说明与警示

- 1、**代码实现中不存在轮询**。轮询是一种非常占用 CPU 资源的行为，为了避免出现轮询的情况，**请使用 Wait-Notify 的方式编程**。同时，为了检查是否出现轮询的情况，总 CPU 时间限制为 10s，不满足该限制的程序会被判定为错误。

- $ 2、$关于接口的一些使用，可以在 idea 里面，按 Ctrl+Q 。将可以看到类和方法的使用格式以及注释（本次官方提供的接口均提供了中文版 javadoc 注释，Ctrl+Q 可以直接查看）。

- $ 3、$请**在代码一开始就初始化时间戳**，否则可能会出现和评测不一致的情况。

  ```java
  import com.oocourse.elevator1.TimableOutput;
  
  public class MainClass {
    public static void main(String[] args) {
      TimableOutput.initStartTimestamp();  // 初始化时间戳
  		/*
  			代码部分
  		*/
    }
  }
  ```

- $ 4、$官方提供的输出包是**线程安全**的，同学们无需对其进行同步控制。

- $ 5、$由于**多线程调度存在随机性**，在使用官方提供的投喂脚本或进行互测环节时，可能会出现**输出与官方评测机不一致、bug 无法复现的情况**，最终结果均**以官方评测机为准**。
- $ 6、$**基于行断点机制的调试会对程序的运行行为产生较大影响，应谨慎使用**。
### 警示

<font color = red>不要试图Hack评测机，不要抄袭。如发现其他人的代码疑似存在上述行为，可向课程组举报。课程组感谢同学们为课程建设所作出的贡献。</font>
